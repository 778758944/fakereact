{"map":"{\"version\":3,\"file\":\"ReactDOMComponent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../src/ReactDOMComponent.ts\"],\"names\":[],\"mappings\":\"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\"}","code":"import ReactElement from \"./ReactElement\";\r\nimport ReactReconciler from \"./ReactReconciler\";\r\nimport { dfsWalk, ChangeType, MoveType } from \"./DomDiff\";\r\nfunction isAttachEvent(key) {\r\n    if (key.substring(0, 2) === \"on\") {\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\nfunction isPropsChildren(key) {\r\n    return key === \"children\";\r\n}\r\nvar ReactDOMComponent = /** @class */ (function () {\r\n    function ReactDOMComponent(ele, container) {\r\n        this._currentElement = ele;\r\n        this._container = container;\r\n    }\r\n    ReactDOMComponent.prototype.mountComponent = function (replaceIndex, isInsert) {\r\n        if (this._currentElement instanceof ReactElement) {\r\n            var props = this._currentElement.props;\r\n            var tagName = this._currentElement.tagName;\r\n            var el = document.createElement(tagName);\r\n            for (var key in props) {\r\n                var val = props[key];\r\n                if (key === \"className\") {\r\n                    el.setAttribute(\"class\", val);\r\n                }\r\n                else if (isAttachEvent(key)) {\r\n                    this.attachEvent(el, key, props[key]);\r\n                }\r\n                else if (isPropsChildren(key)) {\r\n                    //\r\n                }\r\n                else {\r\n                    el.setAttribute(key, val);\r\n                }\r\n            }\r\n            this._renderElement = el;\r\n            this.mountIntoDom(replaceIndex, isInsert);\r\n            if (props && Array.isArray(props.children)) {\r\n                this.mountChildComponent(props.children, el);\r\n            }\r\n            var ref = this._currentElement.ref;\r\n            if (ref) {\r\n                this._ref = ref;\r\n                ref(this._renderElement);\r\n            }\r\n        }\r\n        else if (!!this._currentElement) {\r\n            var textNode = document.createTextNode(this._currentElement + '');\r\n            this._renderElement = textNode;\r\n            this.mountIntoDom(replaceIndex, isInsert);\r\n        }\r\n        else {\r\n            var commentNode = document.createComment(\"Empty Node\");\r\n            this._renderElement = commentNode;\r\n            this.mountIntoDom(replaceIndex, isInsert);\r\n        }\r\n    };\r\n    ReactDOMComponent.prototype.mountIntoDom = function (replaceIndex, isInsert) {\r\n        if (replaceIndex !== undefined) {\r\n            var replaceNode = this._container.childNodes[replaceIndex];\r\n            if (isInsert) {\r\n                this._container.insertBefore(this._renderElement, replaceNode);\r\n            }\r\n            else {\r\n                this._container.replaceChild(this._renderElement, replaceNode);\r\n            }\r\n        }\r\n        else {\r\n            this._container.appendChild(this._renderElement);\r\n        }\r\n    };\r\n    ReactDOMComponent.prototype.mountChildComponent = function (children, container) {\r\n        var _this = this;\r\n        children.forEach(function (child, index) {\r\n            if (Array.isArray(child)) {\r\n                _this.mountChildComponent(child, container);\r\n            }\r\n            else {\r\n                var renderComponent = ReactReconciler.initialComponent(child, container);\r\n                if (!_this._renderChildComponent) {\r\n                    _this._renderChildComponent = [];\r\n                }\r\n                _this._renderChildComponent.push(renderComponent);\r\n                renderComponent.mountComponent();\r\n            }\r\n        });\r\n    };\r\n    ReactDOMComponent.prototype.receiveComponent = function (nextElement) {\r\n        this.updateComponent(this._currentElement, nextElement);\r\n    };\r\n    ReactDOMComponent.prototype.updateComponent = function (prevElement, nextElement) {\r\n        var changes = dfsWalk(prevElement, nextElement);\r\n        if (changes.length > 0) {\r\n            this.updateDomElement(changes);\r\n            this._ref && this._ref(this._renderElement);\r\n        }\r\n        this._currentElement = nextElement;\r\n    };\r\n    ReactDOMComponent.prototype.updateChildComponent = function (children) {\r\n        var _this = this;\r\n        var currentIndex = 0;\r\n        children.forEach(function (child, index) {\r\n            if (Array.isArray(child)) {\r\n                _this.updateChildComponent(child);\r\n                index = index + child.length;\r\n            }\r\n            else if (_this._renderChildComponent && _this._renderChildComponent[index]) {\r\n                var prevInstance = _this._renderChildComponent[index];\r\n                var prevElement = prevInstance._currentElement;\r\n                if (ReactReconciler.shouldUpdateReactComponent(prevElement, child)) {\r\n                    ReactReconciler.receiveComponent(prevInstance, child);\r\n                }\r\n                else {\r\n                    prevInstance.unmountComponent();\r\n                    var nextContainer = void 0;\r\n                    if (_this._renderElement instanceof HTMLElement) {\r\n                        nextContainer = _this._renderElement;\r\n                    }\r\n                    else {\r\n                        nextContainer = _this._container;\r\n                    }\r\n                    _this._renderChildComponent[index] = ReactReconciler.initialComponent(child, nextContainer);\r\n                    _this._renderChildComponent[index].mountComponent(index);\r\n                }\r\n            }\r\n            else {\r\n                if (_this._renderElement instanceof HTMLElement) {\r\n                    if (child || child === 0) {\r\n                        _this._renderChildComponent[index] = ReactReconciler.initialComponent(child, _this._renderElement);\r\n                        _this._renderChildComponent[index].mountComponent();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ReactDOMComponent.prototype.updateDomElement = function (changes) {\r\n        var _this = this;\r\n        changes.forEach(function (change, index) {\r\n            var el = _this._renderElement;\r\n            switch (change.type) {\r\n                case ChangeType.TEXT:\r\n                    if (el.nodeValue && !!change.content) {\r\n                        el.nodeValue = change.content + \"\";\r\n                    }\r\n                    break;\r\n                case ChangeType.PROPS:\r\n                    if (el instanceof HTMLElement && !!change.props) {\r\n                        _this.updateProps(el, change.props);\r\n                    }\r\n                    break;\r\n                case ChangeType.REPLACE:\r\n                    _this.replaceNode(change.node);\r\n                    break;\r\n                case ChangeType.REORDER:\r\n                    if (change.children) {\r\n                        _this.updateChildComponent(change.children);\r\n                    }\r\n                    if (change.moves) {\r\n                        _this.applyMoves(change.moves);\r\n                    }\r\n                    break;\r\n            }\r\n        });\r\n    };\r\n    ReactDOMComponent.prototype.replaceNode = function (newNode) {\r\n        if (newNode) {\r\n            this._currentElement = newNode;\r\n            var el = document.createElement(newNode.tagName);\r\n            this.updateProps(el, newNode.props);\r\n            this._eventListener && this._eventListener.clear();\r\n            this._container.replaceChild(el, this._renderElement);\r\n            this._renderElement = el;\r\n            this._renderChildComponent = [];\r\n        }\r\n        else {\r\n            //\r\n        }\r\n    };\r\n    ReactDOMComponent.prototype.applyMoves = function (moves) {\r\n        var _this = this;\r\n        moves.forEach(function (move, index) { return _this.reorderNode(move); });\r\n    };\r\n    ReactDOMComponent.prototype.reorderNode = function (move) {\r\n        if (move.type === MoveType.INSERT) {\r\n            if (move.item) {\r\n                var container = void 0;\r\n                if (this._renderElement instanceof HTMLElement) {\r\n                    container = this._renderElement;\r\n                }\r\n                else {\r\n                    container = this._container;\r\n                }\r\n                var renderComponent = ReactReconciler.initialComponent(move.item, container);\r\n                this._renderChildComponent.splice(move.index, 0, renderComponent);\r\n                renderComponent.mountComponent(move.index, true);\r\n            }\r\n        }\r\n        else {\r\n            this._renderChildComponent[move.index] && this._renderChildComponent[move.index].unmountComponent();\r\n            var removeNode = this._renderElement.childNodes[move.index];\r\n            this._renderElement.removeChild(removeNode);\r\n        }\r\n    };\r\n    ReactDOMComponent.prototype.unmountComponent = function () {\r\n        if (Array.isArray(this._renderChildComponent)) {\r\n            this._renderChildComponent.forEach(function (child, index) {\r\n                ReactReconciler.unmountComponent(child);\r\n            });\r\n        }\r\n        this._ref && this._ref(null);\r\n        delete this._container;\r\n        delete this._renderChildComponent;\r\n        delete this._renderElement;\r\n        delete this._eventListener;\r\n        delete this._currentElement;\r\n        delete this._ref;\r\n    };\r\n    ReactDOMComponent.prototype.updateProps = function (el, props) {\r\n        for (var key in props) {\r\n            if (key === \"className\") {\r\n                el.setAttribute(\"class\", props[key]);\r\n            }\r\n            else if (isAttachEvent(key)) {\r\n                this.attachEvent(el, key, props[key]);\r\n            }\r\n            else {\r\n                el.setAttribute(key, props[key]);\r\n            }\r\n        }\r\n    };\r\n    ReactDOMComponent.prototype.attachEvent = function (el, key, val) {\r\n        var eventName = key.substring(2).toLowerCase();\r\n        var eventHandle = function (e) {\r\n            e.stopPropagation ? e.stopPropagation() : e.cancelBubble = true;\r\n            val(e);\r\n        };\r\n        var oldEventListener;\r\n        if (!this._eventListener) {\r\n            this._eventListener = new Map();\r\n        }\r\n        else if (this._eventListener.has(eventName)) {\r\n            oldEventListener = this._eventListener.get(eventName) || eventHandle;\r\n            el.removeEventListener(eventName, oldEventListener);\r\n        }\r\n        this._eventListener.set(eventName, eventHandle);\r\n        el.addEventListener(eventName, eventHandle, false);\r\n    };\r\n    return ReactDOMComponent;\r\n}());\r\nexport default ReactDOMComponent;\r\n//# sourceMappingURL=ReactDOMComponent.js.map","dts":{"name":"/Users/tomxing/Documents/FakeReact/ReactDOMComponent.d.ts","writeByteOrderMark":false,"text":"import ReactElement, { ReactNode, ReactDomElement } from \"./ReactElement\";\r\nimport { ReactRenderComponent } from \"./ReactReconciler\";\r\nimport { IChange, IMove } from \"./DomDiff\";\r\ndeclare class ReactDOMComponent {\r\n    _currentElement: ReactDomElement;\r\n    _container: HTMLElement;\r\n    _renderElement: Node;\r\n    _renderChildComponent: ReactRenderComponent[];\r\n    _eventListener: Map<string, (evt: Event) => void>;\r\n    _ref: (e: Node | null) => void;\r\n    constructor(ele: ReactDomElement, container: HTMLElement);\r\n    mountComponent(replaceIndex?: number, isInsert?: boolean): void;\r\n    mountIntoDom(replaceIndex?: number, isInsert?: Boolean): void;\r\n    mountChildComponent(children: ReactNode[], container: HTMLElement): void;\r\n    receiveComponent(nextElement: ReactDomElement): void;\r\n    updateComponent(prevElement: ReactDomElement, nextElement: ReactDomElement): void;\r\n    updateChildComponent(children: ReactNode[]): void;\r\n    updateDomElement(changes: IChange[]): void;\r\n    replaceNode(newNode?: ReactElement<string>): void;\r\n    applyMoves(moves: IMove[]): void;\r\n    reorderNode(move: IMove): void;\r\n    unmountComponent(): void;\r\n    updateProps(el: HTMLElement, props: any): void;\r\n    attachEvent(el: HTMLElement, key: string, val: Function): void;\r\n}\r\nexport default ReactDOMComponent;\r\n"}}
